# G1

G1即Garbage First

## 术语

**STW：**

暂停一切Java应用线程

**SafePoint：**

JVM在执行一些操作时需要STW，但不是任何线程在任何地方都能进入STW，安全点的主要目的是：当线程进入到安全点时，线程就会主动停止

**Mutator：**

指Java应用线程

**记忆集（Remember Set 即RSet）：**

主要记录不同代际对象的引用关系

**Refine：**

G1中的ConcurrentG1RefineThread主要指处理RSet的线程

**Evacuation（Evac）：**

在G1中指发现活跃对象，并将对象复制到新地址的过程

**回收（Reclaim）：**

通常指分区对象已经死亡或者已经完成Evac，分区可以被JVM再次利用

**Closure：**

JVM中的一种辅助类，通常提供对内存的访问

**GC Root：**

可达性分析中，垃圾回收的根。

**Root Set（根集合）：**

GC Root中有线程栈、monitor列表、JNI对象

**Full GC：**

整个对的垃圾回收动作

**Remark：**

并发标记算法中，处理完并发标记后，需要更新并发标记中Mutator变更的引用，这一步需要STW

## 特点

1.G1会根据预测时间动态改变新生代的大小

PS：其他垃圾回收新生代的大小也可以动态变化，但这个变化主要是根据内存的使用情况进行的。G1中则是以预测时间为导向，根据内存的使用情况调整新生代分区的数目。

2.新生代采用并行收集+复制算法

3.老生代部分回收+混合回收（增量回收与新生代回收一起）

4. 待分配的对象大小超过一定阈值之后，直接分配老生代（大对象）、

## 分区（Heap Region 即HR）

- 自由分区 FHR
- 新生代分区YHR
- 大对象分区 HHR
- 老生代分区 OHR

HR的大小直接影响分配与垃圾回收效率，目前HR下限为32MB，下限为1MB

G1通过启发式推断，在不指定HR大小的时候，可推断出HR大小（通过Xms、Xmx计算）

