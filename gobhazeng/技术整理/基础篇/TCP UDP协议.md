# TCP UDP协议

**TCP**是一种面向连接的、可靠的、基于字节流的传输层通信协议。是专门为了在不可靠的互联网络上提供一个可靠的端到端字节流而设计的，面向字节流。

**UDP**（用户数据报协议）是ISO参考模型中一种无连接的传输层协议，提供面向操作的简单不可靠的非连接传输层服务，面向报文。

**它们之间的区别：**

- 1、tcp是基于连接的，可靠性高；udp是基于无连接的，可靠性较低；

- 2、由于tcp是连接的通信，需要有三次握手、重新确认等连接过程，会有延时，实时性差；同时过程复杂，也使其易于被攻击；而udp无连接，无建立连接的过程，因而实时性较强，也稍安全；

- 3、在传输相同大小的数据时，tcp首部开销20字节；udp首部开销只有8个字节，tcp报头比udp复杂，故实际包含的用户数据较少。tcp无丢包，而udp有丢包，故tcp开销大，udp开销较小；

- 4、每条tcp连接只能是点到点的；udp支持一对一、一对多、多对一、多对多的交互通信。

**所以对于应用这方面：**

如果对实时性要求高和高速传输的场合下需要使用UDP；如果需要传输大量数据且对可靠性要求高的情况下应该使用TCP；在可靠性要求较低，追求效率的情况下应该使用UDP。

**TCP的“三次握手，四次挥手”**

对于TCP来说，既然需要面向连接，就会涉及到三个阶段：连接建立、数据传送、连接释放三个过程；而“三次握手”就发生在连接建立这个阶段。

**三次握手：**

- 第一次握手：客户端发送一个tcp的syn标志位置为1的包（连接请求），指明客户打算连接服务器的端口；

- 第二次握手：当服务器收到连接请求之后，返回确认包（ack）应答，即将syn和ack标志位同时致为1（授予连接），并为这次连接分配资源；

- 第三次握手：客户端收到服务器的授予连接请求之后，再次发送确认包（ack）（syn标志位为0，ack标志位为1），并分配资源，这样tcp就建立连接了。

![](http://ovsf6lwoc.bkt.clouddn.com/image/jpg/20179192312.jpg)

三次握手完成，TCP客户端和服务器端成功地建立连接，可以开始传输数据了。

**四次挥手：**

> 建立一个连接需要三次握手，而终止一个连接要经过四次握手，这是由TCP的半关闭（half-close）造成的。

- 第一次挥手：某个应用进程首先调用close，称该端执行“主动关闭”（active close）。该端的TCP于是发送一个FIN分节，表示数据发送完毕。

- 第二次挥手：接收到这个FIN的对端执行 “被动关闭”（passive close），这个FIN由TCP确认。

> 注意：FIN的接收也作为一个文件结束符（end-of-file）传递给接收端应用进程，放在已排队等候该应用进程接收的任何其他数据之后，因为，FIN的接收意味着接收端应用进程在相应连接上再无额外数据可接收。

- 第三次挥手：一段时间后，接收到这个文件结束符的应用进程将调用close关闭它的套接字。这导致它的TCP也发送一个FIN。

- 第四次挥手：接收这个最终FIN的原发送端TCP（即执行主动关闭的那一端）确认这个FIN。

![](http://ovsf6lwoc.bkt.clouddn.com/image/jpg/201709192326.jpg)

**既然每个方向都需要一个FIN和一个ACK，因此通常需要4个分节。**